<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>HIMOS Chat</title>

<style>
body{
  margin:0;
  background:#0b0b0b;
  font-family:Arial;
  color:#fff;
}
.chat{
  max-width:480px;
  margin:15px auto;
  background:#111;
  border-radius:15px;
  overflow:hidden;
  box-shadow:0 0 25px #000;
}
.header{
  background:#00ff88;
  color:#000;
  padding:14px;
  text-align:center;
  font-weight:bold;
}
#messages{
  height:380px;
  overflow-y:auto;
  padding:12px;
  background:#0a0a0a;
}
.msg{
  margin:8px 0;
  padding:8px 10px;
  border-radius:10px;
  max-width:85%;
}
.me{margin-left:auto;}
.user{
  font-size:12px;
  font-weight:bold;
}
.time{
  font-size:10px;
  opacity:.6;
}
.reply{
  font-size:11px;
  opacity:.7;
  border-left:3px solid #00ff88;
  padding-left:5px;
}
.footer{
  display:flex;
}
.footer input{
  flex:1;
  padding:14px;
  border:none;
}
.footer button{
  background:#00ff88;
  border:none;
  padding:14px;
  font-weight:bold;
  cursor:pointer;
}
.admin{color:#ff0055;}
.stats{
  font-size:12px;
  padding:5px;
  background:#000;
  text-align:center;
}
</style>
</head>

<body>

<div class="chat">
  <div class="header">ğŸ’¬ HIMOS Chat</div>
  <div id="stats" class="stats" style="display:none;"></div>
  <div id="messages"></div>
  <div class="footer">
    <input id="msg" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø© Ù…Ø­ØªØ±Ù…Ø©...">
    <button onclick="send()">Ø¥Ø±Ø³Ø§Ù„</button>
  </div>
</div>

<audio id="sound" src="https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg"></audio>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
var firebaseConfig = {
  apiKey: "AIzaSyBEazcwOjQFvTTvKP7C-LltEOnIlkF54x0",
  authDomain: "chat-ab546.firebaseapp.com",
  databaseURL: "https://chat-ab546-default-rtdb.firebaseio.com",
  projectId: "chat-ab546",
  storageBucket: "chat-ab546.appspot.com",
  messagingSenderId: "1096336837314",
  appId: "1:1096336837314:web:2abe8434e5ced8ca1a895b"
};
firebase.initializeApp(firebaseConfig);

const db = firebase.database();
const chatRef = db.ref("chat");
const bansRef = db.ref("bans");
const statsRef = db.ref("stats");

const ADMIN = "HOMOS";
const DAY = 86400000;

// ğŸ§  Ø§Ù„Ø§Ø³Ù…
let username = localStorage.getItem("chatName");
if(!username){
  username = prompt("Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ");
  localStorage.setItem("chatName",username);
}

// ğŸ¨ Ù„ÙˆÙ† Ø«Ø§Ø¨Øª
function color(name){
  let hash=0;
  for(let i=0;i<name.length;i++) hash=name.charCodeAt(i)+((hash<<5)-hash);
  return `hsl(${hash%360},70%,60%)`;
}

// ğŸš« ÙØ­Øµ Ø§Ù„Ø­Ø¸Ø±
bansRef.child(username).once("value",s=>{
  if(s.exists() && Date.now()-s.val()<DAY){
    document.body.innerHTML="<h2 style='text-align:center;margin-top:100px'>ğŸš« Ù…Ø­Ø¸ÙˆØ± 24 Ø³Ø§Ø¹Ø©</h2>";
  }else{
    bansRef.child(username).remove();
  }
});

// â±ï¸ ÙˆÙ‚Øª
function timeAgo(t){
  let d=(Date.now()-t)/1000;
  if(d<60) return "Ø§Ù„Ø¢Ù†";
  if(d<3600) return `Ù…Ù†Ø° ${Math.floor(d/60)} Ø¯Ù‚ÙŠÙ‚Ø©`;
  return `Ù…Ù†Ø° ${Math.floor(d/3600)} Ø³Ø§Ø¹Ø©`;
}

// ğŸ“¤ Ø¥Ø±Ø³Ø§Ù„
function send(){
  let m=msg.value;
  if(!m) return;
  chatRef.push({
    user: username,
    text: m,
    time: Date.now()
  });
  statsRef.child("messages").transaction(n=>(n||0)+1);
  msg.value="";
}

// ğŸ“¥ Ø§Ø³ØªÙ‚Ø¨Ø§Ù„
chatRef.limitToLast(100).on("child_added",snap=>{
  let d=snap.val();
  let div=document.createElement("div");
  div.className="msg "+(d.user===username?"me":"");
  div.style.background=color(d.user);
  div.innerHTML=`
    <div class="user ${d.user===ADMIN?'admin':''}">
      ${d.user===ADMIN?'ğŸ‘‘ ':''}${d.user}
    </div>
    <div>${d.text}</div>
    <div class="time">${timeAgo(d.time)}</div>
  `;
  messages.appendChild(div);
  messages.scrollTop=messages.scrollHeight;
  if(d.user!==username) sound.play();
});

// ğŸ“Š Ø¥Ø­ØµØ§Ø¦ÙŠØ§Øª Ù„Ù„Ø£Ø¯Ù…Ù†
if(username===ADMIN){
  stats.style.display="block";
  statsRef.on("value",s=>{
    let m=s.val()?.messages||0;
    stats.innerText=`ğŸ“Š Ø¹Ø¯Ø¯ Ø§Ù„Ø±Ø³Ø§Ø¦Ù„: ${m}`;
  });
}
</script>

</body>
</html>
