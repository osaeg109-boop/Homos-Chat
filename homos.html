<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<title>HIMOS Chat</title>

<style>
body{
  margin:0;
  background:linear-gradient(135deg,#0f2027,#203a43,#2c5364);
  font-family:Arial;
  color:#fff;
}
.chat-box{
  max-width:450px;
  margin:20px auto;
  background:#111;
  border-radius:15px;
  overflow:hidden;
  box-shadow:0 0 20px #000;
}
.header{
  background:#00ff88;
  color:#000;
  padding:14px;
  text-align:center;
  font-weight:bold;
  font-size:18px;
}
.online{
  font-size:13px;
}
#messages{
  height:380px;
  overflow-y:auto;
  padding:12px;
  background:#0a0a0a;
}
.msg{
  margin:8px 0;
  padding:8px 10px;
  border-radius:10px;
  max-width:85%;
  animation:fade .3s;
}
.me{
  background:#00ff88;
  color:#000;
  margin-left:auto;
}
.other{
  background:#1e1e1e;
}
.user{
  font-size:12px;
  opacity:.8;
}
.footer{
  display:flex;
  border-top:1px solid #222;
}
.footer input{
  flex:1;
  padding:14px;
  border:none;
  outline:none;
}
.footer button{
  background:#00ff88;
  border:none;
  padding:14px;
  font-weight:bold;
  cursor:pointer;
}
.name-box{
  padding:20px;
  text-align:center;
}
.name-box input{
  width:90%;
  padding:12px;
}
.hidden{display:none;}

@keyframes fade{
  from{opacity:0;transform:translateY(5px)}
  to{opacity:1}
}
</style>
</head>

<body>

<div class="chat-box">
  <div class="header">
    ðŸ’¬ HIMOS Chat
    <div class="online">ðŸŸ¢ Ø§Ù„Ù…ØªØµÙ„ÙŠÙ†: <span id="online">0</span></div>
  </div>

  <div id="nameBox" class="name-box hidden">
    <h3>Ø§ÙƒØªØ¨ Ø§Ø³Ù…Ùƒ Ù„Ù„Ø¯Ø®ÙˆÙ„</h3>
    <input id="nameInput" placeholder="Ø§Ø³Ù…Ùƒ">
    <br><br>
    <button onclick="saveName()">Ø¯Ø®ÙˆÙ„</button>
  </div>

  <div id="messages"></div>

  <div class="footer">
    <input id="msg" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø© Ù…Ø­ØªØ±Ù…Ø©...">
    <button onclick="send()">Ø¥Ø±Ø³Ø§Ù„</button>
  </div>
</div>

<!-- Firebase -->
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
// ðŸ”´ Firebase Config
var firebaseConfig = {
  apiKey: "AIzaSyBEazcwOjQFvTTvKP7C-LltEOnIlkF54x0",
  authDomain: "chat-ab546.firebaseapp.com",
  databaseURL: "https://chat-ab546-default-rtdb.firebaseio.com",
  projectId: "chat-ab546",
  storageBucket: "chat-ab546.appspot.com",
  messagingSenderId: "1096336837314",
  appId: "1:1096336837314:web:2abe8434e5ced8ca1a895b"
};
firebase.initializeApp(firebaseConfig);

var db = firebase.database();
var chatRef = db.ref("chat");
var onlineRef = db.ref("online");

const DAY = 86400000;

// ðŸš« Ù†Ø¸Ø§Ù… Ø§Ù„Ø­Ø¸Ø±
let strikes = localStorage.getItem("strikes") || 0;
if(strikes >= 6){
  document.body.innerHTML = "<h1 style='text-align:center;margin-top:100px'>ðŸš« ØªÙ… Ø­Ø¸Ø±Ùƒ Ù†Ù‡Ø§Ø¦ÙŠÙ‹Ø§ Ù…Ù† HIMOS Chat</h1>";
  throw "BANNED";
}

// ðŸ§  Ø§Ù„Ø§Ø³Ù…
let username = localStorage.getItem("chatName");
if(!username){
  document.getElementById("nameBox").classList.remove("hidden");
}

function saveName(){
  let n = nameInput.value.trim();
  if(n.length>=2){
    localStorage.setItem("chatName",n);
    location.reload();
  }
}

// ðŸš« ÙƒÙ„Ù…Ø§Øª Ù…Ù…Ù†ÙˆØ¹Ø©
let bannedWords = ["ÙƒÙ„Ø¨","Ø­Ù…Ø§Ø±","fuck","shit","ÙƒØ³","Ø²Ø¨","Ù„Ø¹Ù†Ø©","Ø§Ø­Ø§"];

function checkBad(text){
  let bad=false;
  bannedWords.forEach(w=>{
    let r=new RegExp(w,"gi");
    if(r.test(text)) bad=true;
    text=text.replace(r,"***");
  });
  if(bad){
    strikes++;
    localStorage.setItem("strikes",strikes);
    alert("âš ï¸ ØªØ­Ø°ÙŠØ±: ÙƒÙ„Ù…Ø§Øª ØºÙŠØ± Ù„Ø§Ø¦Ù‚Ø© ("+strikes+"/6)");
  }
  return {text,bad};
}

// ðŸ“¤ Ø¥Ø±Ø³Ø§Ù„
function send(){
  let msg = document.getElementById("msg").value;
  if(!msg || !username) return;

  let result = checkBad(msg);
  if(strikes>=6){
    localStorage.setItem("strikes",6);
    location.reload();
    return;
  }

  chatRef.push({
    user: username,
    text: result.text,
    time: Date.now()
  });
  msg.value="";
}

// ðŸ“¥ Ø§Ø³ØªÙ‚Ø¨Ø§Ù„
chatRef.on("child_added",snap=>{
  let d=snap.val();
  if(Date.now()-d.time>DAY){
    snap.ref.remove();
    return;
  }

  let div=document.createElement("div");
  div.className="msg "+(d.user===username?"me":"other");
  div.innerHTML=`<div class="user">${d.user}</div>${d.text}`;
  messages.appendChild(div);
  messages.scrollTop=messages.scrollHeight;
});

// ðŸŸ¢ Ù…ØªØµÙ„ÙŠÙ†
let me = onlineRef.push(true);
me.onDisconnect().remove();
onlineRef.on("value",s=>{
  online.innerText=s.numChildren();
});
</script>

</body>
</html>
