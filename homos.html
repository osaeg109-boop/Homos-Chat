<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>HIMOS Chat</title>

<link rel="icon" href="Logo.jpeg">

<meta property="og:title" content="HIMOS Chat">
<meta property="og:description" content="Ø´Ø§Øª Ø¹Ø§Ù… Ù…Ø¨Ø§Ø´Ø± Ø¨ØªØ¬Ø±Ø¨Ø© ØªØ·Ø¨ÙŠÙ‚ Ø­Ù‚ÙŠÙ‚ÙŠØ©">
<meta property="og:image" content="Logo.jpeg">

<style>
*{box-sizing:border-box}

html,body{
  height:100%;
  overflow:hidden;
}

body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Arial;
  background:#0f0f0f;
  color:#fff;
  overscroll-behavior:none;
}

/* ===== App Container ===== */
.chat{
  height:100dvh;
  display:flex;
  flex-direction:column;
}

/* ===== Header ===== */
.header{
  background:#00ff88;
  color:#000;
  padding:12px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:bold;
  position:relative;
}
.header img{
  height:34px;
  margin-right:8px;
}
.online{
  position:absolute;
  right:10px;
  font-size:12px;
}

/* ===== Pinned Message ===== */
#pinned{
  display:none;
  background:linear-gradient(90deg,#00ff88,#00ccff);
  color:#000;
  padding:8px;
  text-align:center;
  font-weight:bold;
}

/* ===== Messages ===== */
#messages{
  flex:1;
  padding:10px;
  overflow-y:auto;
  scrollbar-width:none;
}
#messages::-webkit-scrollbar{display:none}

.msg{
  display:flex;
  margin-bottom:10px;
  animation:pop .2s ease;
}
@keyframes pop{
  from{transform:scale(.95);opacity:0}
  to{transform:scale(1);opacity:1}
}
.avatar{
  width:36px;
  height:36px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:bold;
  margin-right:8px;
}
.msg-content{
  background:#1f1f1f;
  padding:8px 10px;
  border-radius:14px;
  max-width:80%;
}
.me .msg-content{
  background:#00ff88;
  color:#000;
  margin-left:auto;
}
.user{
  font-size:12px;
  font-weight:bold;
}
.time{
  font-size:10px;
  opacity:.6;
}

/* ===== Reactions ===== */
.reactions{
  margin-top:4px;
}
.reactions span{
  background:#00000055;
  padding:3px 7px;
  border-radius:12px;
  font-size:12px;
  margin-right:4px;
  cursor:pointer;
}

/* ===== Footer ===== */
.footer{
  padding:8px;
  background:#111;
  display:flex;
  gap:6px;
}
.footer input{
  flex:1;
  padding:12px;
  border:none;
  border-radius:12px;
  outline:none;
  font-size:16px; /* âœ… Ø­Ù„ Ù…Ø´ÙƒÙ„Ø© ØªÙƒØ¨ÙŠØ± Ø§Ù„Ø¢ÙŠÙÙˆÙ† */
  -webkit-text-size-adjust:100%;
}
.footer button{
  background:#00ff88;
  border:none;
  padding:12px 16px;
  border-radius:12px;
  font-weight:bold;
}
</style>
</head>

<body>

<div class="chat">
  <div class="header">
    <img src="Logo.jpeg">
    HIMOS Chat
    <span class="online">ğŸŸ¢ <span id="online">0</span></span>
  </div>

  <div id="pinned"></div>

  <div id="messages"></div>

  <div class="footer">
    <input id="msg" placeholder="Ø§ÙƒØªØ¨ Ø±Ø³Ø§Ù„Ø©â€¦">
    <button onclick="send()">Ø¥Ø±Ø³Ø§Ù„</button>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
/* ===== Firebase ===== */
firebase.initializeApp({
  apiKey: "AIzaSyBEazcwOjQFvTTvKP7C-LltEOnIlkF54x0",
  authDomain: "chat-ab546.firebaseapp.com",
  databaseURL: "https://chat-ab546-default-rtdb.firebaseio.com",
  projectId: "chat-ab546"
});

const db = firebase.database();
const chatRef = db.ref("chat");
const pinnedRef = db.ref("pinnedMessage");
const onlineRef = db.ref("online");

const ADMIN = "Mohamed Homos";
const AUTO_DELETE_TIME = 172800000; // 48 Ø³Ø§Ø¹Ø©

/* ===== User ===== */
let username = localStorage.getItem("chatName");
if(!username){
  username = prompt("Ø§Ø³Ù…ÙƒØŸ");
  localStorage.setItem("chatName",username);
}

/* ===== Utils ===== */
function color(n){
  let h=0;
  for(let c of n) h=c.charCodeAt(0)+((h<<5)-h);
  return `hsl(${h%360},70%,60%)`;
}

/* ===== Online ===== */
let me = onlineRef.push(true);
me.onDisconnect().remove();
onlineRef.on("value",s=>{
  online.innerText=s.numChildren();
});

/* ===== Pinned ===== */
pinnedRef.on("value",s=>{
  if(s.exists()){
    pinned.style.display="block";
    pinned.innerText="ğŸ“Œ "+s.val().text;
  }else pinned.style.display="none";
});

/* ===== Send ===== */
function send(){
  let t=msg.value.trim();
  if(!t) return;
  chatRef.push({
    user:username,
    text:t,
    time:Date.now(),
    reactions:{like:0,love:0,laugh:0,fire:0}
  });
  msg.value="";
}

/* ===== Chat ===== */
chatRef.limitToLast(200).on("child_added",snap=>{
  let d=snap.val();
  if(Date.now()-d.time>AUTO_DELETE_TIME){
    snap.ref.remove(); return;
  }

  let div=document.createElement("div");
  div.className="msg "+(d.user===username?"me":"");
  div.innerHTML=`
    <div class="avatar" style="background:${color(d.user)}">${d.user[0]}</div>
    <div class="msg-content">
      <div class="user">${d.user}</div>
      <div>${d.text}</div>
      <div class="reactions">
        <span onclick="react('${snap.key}','like')">ğŸ‘ ${d.reactions.like}</span>
        <span onclick="react('${snap.key}','love')">â¤ï¸ ${d.reactions.love}</span>
        <span onclick="react('${snap.key}','laugh')">ğŸ˜‚ ${d.reactions.laugh}</span>
        <span onclick="react('${snap.key}','fire')">ğŸ”¥ ${d.reactions.fire}</span>
        ${username===ADMIN?`<span onclick="pin('${snap.key}')">ğŸ“Œ</span>`:""}
      </div>
      <div class="time">${new Date(d.time).toLocaleTimeString()}</div>
    </div>`;
  messages.appendChild(div);
  messages.scrollTop=messages.scrollHeight;
});

/* ===== Reactions ===== */
function react(k,t){
  chatRef.child(k).child("reactions").child(t)
  .transaction(n=>(n||0)+1);
}

/* ===== Pin ===== */
function pin(k){
  chatRef.child(k).once("value",s=>{
    pinnedRef.set({text:s.val().text});
  });
}

/* ===== Service Worker ===== */
if('serviceWorker' in navigator){
  navigator.serviceWorker.register("firebase-messaging-sw.js");
}
</script>

</body>
</html>
