<!DOCTYPE html>
<html lang="ar">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, viewport-fit=cover">
<title>HIMOS Chat</title>

<link rel="icon" href="Logo.jpeg">

<meta property="og:title" content="HIMOS Chat">
<meta property="og:description" content="ÿ¥ÿßÿ™ ÿπÿßŸÖ ŸÖÿ®ÿßÿ¥ÿ± ÿ®ÿ™ÿ¨ÿ±ÿ®ÿ© ÿ™ÿ∑ÿ®ŸäŸÇ ÿ≠ŸÇŸäŸÇŸäÿ©">
<meta property="og:image" content="Logo.jpeg">

<style>
*{box-sizing:border-box}
body{
  margin:0;
  font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Arial;
  background:#0f0f0f;
  color:#fff;
  overscroll-behavior:none;
}
.chat{
  height:100dvh;
  display:flex;
  flex-direction:column;
}
.header{
  background:#00ff88;
  color:#000;
  padding:12px;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:bold;
  position:relative;
}
.header img{height:34px;margin-right:8px}
.online{
  position:absolute;
  right:10px;
  font-size:12px;
}
#pinned{
  display:none;
  background:linear-gradient(90deg,#00ff88,#00ccff);
  color:#000;
  padding:8px;
  text-align:center;
  font-weight:bold;
}
#messages{
  flex:1;
  padding:10px;
  overflow-y:auto;
  scrollbar-width:none;
}
#messages::-webkit-scrollbar{display:none}

.msg{
  display:flex;
  margin-bottom:10px;
  animation:pop .2s ease;
}
@keyframes pop{
  from{transform:scale(.95);opacity:0}
  to{transform:scale(1);opacity:1}
}
.avatar{
  width:36px;height:36px;
  border-radius:50%;
  display:flex;
  align-items:center;
  justify-content:center;
  font-weight:bold;
  margin-right:8px;
}
.msg-content{
  background:#1f1f1f;
  padding:8px 10px;
  border-radius:14px;
  max-width:80%;
  position:relative;
}
.me .msg-content{
  background:#00ff88;
  color:#000;
  margin-left:auto;
}
.user{
  font-size:12px;
  font-weight:bold;
}
.time{
  font-size:10px;
  opacity:.6;
}
.reactions{
  margin-top:4px;
}
.reactions span{
  background:#00000055;
  padding:3px 7px;
  border-radius:12px;
  font-size:12px;
  margin-right:4px;
  cursor:pointer;
}
.footer{
  padding:8px;
  background:#111;
  display:flex;
  gap:6px;
}
.footer input{
  flex:1;
  padding:12px;
  border:none;
  border-radius:12px;
  outline:none;
}
.footer button{
  background:#00ff88;
  border:none;
  padding:12px 16px;
  border-radius:12px;
  font-weight:bold;
}
</style>
</head>

<body>

<div class="chat">
  <div class="header">
    <img src="Logo.jpeg">
    HIMOS Chat
    <span class="online">üü¢ <span id="online">0</span></span>
  </div>

  <div id="pinned"></div>

  <div id="messages"></div>

  <div class="footer">
    <input id="msg" placeholder="ÿßŸÉÿ™ÿ® ÿ±ÿ≥ÿßŸÑÿ©‚Ä¶">
    <button onclick="send()">ÿ•ÿ±ÿ≥ÿßŸÑ</button>
  </div>
</div>

<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>

<script>
var firebaseConfig = {
  apiKey: "AIzaSyBEazcwOjQFvTTvKP7C-LltEOnIlkF54x0",
  authDomain: "chat-ab546.firebaseapp.com",
  databaseURL: "https://chat-ab546-default-rtdb.firebaseio.com",
  projectId: "chat-ab546"
};
firebase.initializeApp(firebaseConfig);

const db = firebase.database();
const chatRef = db.ref("chat");
const pinnedRef = db.ref("pinnedMessage");
const onlineRef = db.ref("online");

const ADMIN = "Mohamed Homos";
const AUTO_DELETE_TIME = 172800000; // 48 ÿ≥ÿßÿπÿ©

let username = localStorage.getItem("chatName");
if(!username){
  username = prompt("ÿßÿ≥ŸÖŸÉÿü");
  localStorage.setItem("chatName",username);
}

function color(n){
  let h=0;for(let c of n)h=c.charCodeAt(0)+((h<<5)-h);
  return `hsl(${h%360},70%,60%)`;
}

let me = onlineRef.push(true);
me.onDisconnect().remove();
onlineRef.on("value",s=>{
  online.innerText=s.numChildren();
});

pinnedRef.on("value",s=>{
  if(s.exists()){
    pinned.style.display="block";
    pinned.innerText="üìå "+s.val().text;
  }else pinned.style.display="none";
});

function send(){
  let t=msg.value.trim();
  if(!t) return;
  chatRef.push({
    user:username,
    text:t,
    time:Date.now(),
    reactions:{like:0,love:0,laugh:0,fire:0}
  });
  msg.value="";
}

chatRef.limitToLast(200).on("child_added",snap=>{
  let d=snap.val();
  if(Date.now()-d.time>AUTO_DELETE_TIME){
    snap.ref.remove();return;
  }
  let div=document.createElement("div");
  div.className="msg "+(d.user===username?"me":"");
  div.innerHTML=`
    <div class="avatar" style="background:${color(d.user)}">${d.user[0]}</div>
    <div class="msg-content">
      <div class="user">${d.user}</div>
      <div>${d.text}</div>
      <div class="reactions">
        <span onclick="react('${snap.key}','like')">üëç ${d.reactions?.like||0}</span>
        <span onclick="react('${snap.key}','love')">‚ù§Ô∏è ${d.reactions?.love||0}</span>
        <span onclick="react('${snap.key}','laugh')">üòÇ ${d.reactions?.laugh||0}</span>
        <span onclick="react('${snap.key}','fire')">üî• ${d.reactions?.fire||0}</span>
        ${username===ADMIN?`<span onclick="pin('${snap.key}')">üìå</span>`:""}
      </div>
      <div class="time">${new Date(d.time).toLocaleTimeString()}</div>
    </div>`;
  messages.appendChild(div);
  messages.scrollTop=messages.scrollHeight;
});

function react(k,t){
  chatRef.child(k).child("reactions").child(t)
  .transaction(n=>(n||0)+1);
}

function pin(k){
  chatRef.child(k).once("value",s=>{
    pinnedRef.set({text:s.val().text});
  });
}

if('serviceWorker'in navigator){
  navigator.serviceWorker.register("firebase-messaging-sw.js");
}
</script>

</body>
</html>
